<div *ngIf="isOpen" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ customer?.customerName }} - New Order</h3>
    </div>
    
    <div class="modal-body">
      <form [formGroup]="orderForm" (ngSubmit)="onSubmit()" class="order-form">
        
        <div class="form-section">
          <h4 class="section-title">Order</h4>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Employee*</mat-label>
              <mat-select formControlName="empID">
                <mat-option *ngFor="let employee of employees()" [value]="employee.empID">
                  {{ employee.firstName }} {{ employee.lastName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="getFieldError('empID')">
                {{ getFieldError('empID') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Shipper*</mat-label>
              <mat-select formControlName="shipperID">
                <mat-option *ngFor="let shipper of shippers()" [value]="shipper.shipperID">
                  {{ shipper.companyName }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="getFieldError('shipperID')">
                {{ getFieldError('shipperID') }}
              </mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Ship Name*</mat-label>
            <input matInput formControlName="shipName" placeholder="Enter ship name">
            <mat-error *ngIf="getFieldError('shipName')">
              {{ getFieldError('shipName') }}
            </mat-error>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Ship Address*</mat-label>
              <input matInput formControlName="shipAddress" placeholder="Enter address">
              <mat-error *ngIf="getFieldError('shipAddress')">
                {{ getFieldError('shipAddress') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Ship City*</mat-label>
              <input matInput formControlName="shipCity" placeholder="Enter city">
              <mat-error *ngIf="getFieldError('shipCity')">
                {{ getFieldError('shipCity') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Ship Country*</mat-label>
              <input matInput formControlName="shipCountry" placeholder="Enter country">
              <mat-error *ngIf="getFieldError('shipCountry')">
                {{ getFieldError('shipCountry') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Order Date*</mat-label>
              <input matInput [matDatepicker]="orderPicker" formControlName="orderDate" readonly>
              <mat-datepicker-toggle matIconSuffix [for]="orderPicker" disabled></mat-datepicker-toggle>
              <mat-datepicker #orderPicker></mat-datepicker>
              <mat-error *ngIf="getFieldError('orderDate')">
                {{ getFieldError('orderDate') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Required Date*</mat-label>
              <input matInput [matDatepicker]="requiredPicker" formControlName="requiredDate">
              <mat-datepicker-toggle matIconSuffix [for]="requiredPicker"></mat-datepicker-toggle>
              <mat-datepicker #requiredPicker></mat-datepicker>
              <mat-error *ngIf="getFieldError('requiredDate')">
                {{ getFieldError('requiredDate') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Shipped Date*</mat-label>
              <input matInput [matDatepicker]="shippedPicker" formControlName="shippedDate">
              <mat-datepicker-toggle matIconSuffix [for]="shippedPicker"></mat-datepicker-toggle>
              <mat-datepicker #shippedPicker></mat-datepicker>
              <mat-error *ngIf="getFieldError('shippedDate')">
                {{ getFieldError('shippedDate') }}
              </mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Freight*</mat-label>
            <span matPrefix>$&nbsp;</span>
            <input matInput type="number" step="0.01" formControlName="freight" placeholder="0.00">
            <mat-error *ngIf="getFieldError('freight')">
              {{ getFieldError('freight') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-section">
          <h4 class="section-title">Order Details</h4>
          
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Product*</mat-label>
            <mat-select formControlName="productID" (selectionChange)="onProductChange()">
              <mat-option *ngFor="let product of availableProducts" [value]="product.productID">
                {{ product.productName }} - ${{ product.unitPrice }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="getFieldError('productID')">
              {{ getFieldError('productID') }}
            </mat-error>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Unit Price*</mat-label>
              <span matPrefix>$&nbsp;</span>
              <input matInput type="number" step="0.01" formControlName="unitPrice" placeholder="0.00">
              <mat-error *ngIf="getFieldError('unitPrice')">
                {{ getFieldError('unitPrice') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Quantity*</mat-label>
              <input matInput type="number" formControlName="quantity" placeholder="1">
              <mat-error *ngIf="getFieldError('quantity')">
                {{ getFieldError('quantity') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Discount*</mat-label>
              <input matInput type="number" step="0.01" formControlName="discount" placeholder="0.00">
              <span matSuffix>%</span>
              <mat-error *ngIf="getFieldError('discount')">
                {{ getFieldError('discount') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <div class="form-actions">
          <span type="button" (click)="closeModal()" class="close-text">
            CLOSE
          </span>
          <span type="submit" (click)="onSubmit()" [class.disabled]="isLoading()" class="save-text">
            {{ isLoading() ? 'SAVING...' : 'SAVE' }}
          </span>
        </div>
      </form>
    </div>
  </div>
</div>